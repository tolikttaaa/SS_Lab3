<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SS Lab3</title>

    <script src="sockjs.js"></script>
    <script src="stomp.js"></script>
    <script type="text/javascript">
      var stompClient = null;
      var password = null;
      var id = null;

      function setConnected(connected) {
        document.getElementById('connect').disabled = connected;
        document.getElementById('disconnect').disabled = !connected;
        document.getElementById('startConversationDiv').style.visibility = connected ? 'visible' : 'hidden';
        document.getElementById('scriptConversationDiv').style.visibility = connected ? 'visible' : 'hidden';
        document.getElementById('conversationDiv').style.visibility = connected ? 'visible' : 'hidden';
        document.getElementById('response').innerHTML = '';
      }

      function setScriptConversationMode(isScriptMode) {
        document.getElementById('startConversationDiv').style.visibility = !isScriptMode ? 'visible' : 'hidden';
        document.getElementById('scriptConversationDiv').style.visibility = isScriptMode ? 'visible' : 'hidden';
        document.getElementById('response').innerHTML = '';
      }

      function connect() {
        var socket = new SockJS('/greeting');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function(frame) {
          setConnected(true);
          console.log('Connected: ' + frame);

          stompClient.subscribe("/user/queue/list_mode_reply", function(message) {
            if (JSON.parse(message.body).errorMessage !== 'null') {
              showErrorMessage(JSON.parse(message.body).errorMessage);
            } else {
              showMessage(JSON.parse(message.body).list);
            }
          });
        });
      }

      // window.onload = function () {
      //   setScriptConversationMode(false);
      //   setConnected(false);
      // }

      function disconnect() {
        stompClient.disconnect();
        setConnected(false);
        // sendEndCommand();
        console.log("Disconnected");
      }

      function sendListModeRequest() {
        stompClient.send("/app/list_mode");
      }

      function sendScriptModeStartRequest() {
        let deviceName = document.getElementById('deviceName').value;
        stompClient.send("/app/script_mode_start", {}, JSON.stringify({ 'deviceName': deviceName}));
      }

      function showMessage(message) {
        var response = document.getElementById('response');
        var p = document.createElement('p');
        p.style.wordWrap = 'break-word';
        p.appendChild(document.createTextNode(message));
        response.appendChild(p);
      }

      function showErrorMessage(message) {
        var response = document.getElementById('response');
        var p = document.createElement('p');
        p.style.wordWrap = 'break-word';
        p.style.color = 'red';
        p.appendChild(document.createTextNode(message));
        response.appendChild(p);
      }
    </script>
  </head>
  <body>
    <noscript>
      <h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being enabled. Please enable
      Javascript and reload this page!</h2>
    </noscript>
    <div>
      <div>
        <button id="connect" onclick="connect();">Connect</button>
        <button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
      </div>

      <div id="conversationDiv">
        <div id="startConversationDiv">
          <p>
            <label>List mode request</label>
            <button id="listRequest" onclick="sendListModeRequest();">Send</button>
          </p>
          <p>
            <label>Script mode request</label>
            <input type="text" id="deviceName" placeholder="device name"/>
            <button id="scriptModeStartRequest" onclick="sendScriptModeStartRequest();">Send</button>
          </p>
        </div>
        <div id="scriptConversationDiv">
          <p>
            <label for="helpCommand">Help command: </label>
            <button id="helpCommand" onclick="sendHelpRequest();">help</button>
          </p>
          <p>
            <label for="lsCommand">Ls command: </label>
            <button id="lsCommand" onclick="sendLsRequest();">ls</button>
          </p>
          <p>
            <label for="pwdCommand">Pwd command: </label>
            <button id="pwdCommand" onclick="sendPwdRequest();">pwd</button>
          </p>
          <p>
            <label for="cdCommand">Cd command: </label>
            <button id="cdCommand" onclick="sendCdRequest();">cd</button>
            <label for="cdArg1">Arg1 </label><input type="text" id="cdArg1" placeholder="to"/>
          </p>
          <p>
            <label for="cpCommand">Cp command: </label>
            <button id="cpCommand" onclick="sendCpRequest();">cp</button>
            <label for="cpArg1">Arg1 </label><input type="text" id="cpArg1" placeholder="from"/>
            <label for="cpArg2">Arg2 </label><input type="text" id="cpArg2" placeholder="to"/>
          </p>
          <p>
            <label for="exitCommand">Exit command: </label>
            <button id="exitCommand" onclick="sendExitRequest();">exit</button>
          </p>
          <!--TODO: scriptConversationDiv-->
        </div>
        <p id="response"></p>
      </div>
    </div>
  </body>
</html>